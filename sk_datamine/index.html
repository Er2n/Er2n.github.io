<html>

<head>
    <link rel="shortcut icon" href="icon.webp" type="image/webp">
    <title>SoulKnight dataminer</title>
    <style>
        textarea {
            resize: none;
            width: 100%;
        }

        body {
            font-family: "Trebuchet MS";
            text-align: center;
        }

        #input {
            cursor: pointer;
            border-radius: 3px;
            padding: 10px 25px;
            color: #000;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 0 7px rgb(134, 134, 134);
            transition: box-shadow .1s;
        }

        #down {
            text-decoration: none;
            color: #000;
        }
        #link {
            height: 40px;
            width: 170px;
            border: 2px dashed silver;
            display: table-cell;
            vertical-align: middle;
            font-size: 22px;
            font-weight: 800;
        }

        #input:hover {
            box-shadow: 0 0 10px rgb(77, 77, 77);
        }

        #patches {
            border: 2px dashed silver;
            height: 400px;
            width: 800px;
            margin: 10px;
            overflow-x: scroll;
            overflow-y: hidden;
            padding: 15px;
            white-space: nowrap;
            margin-left: calc(50% - 400px);
        }

        .pers {
            border: 2px dashed silver;
            height: 100%;
            width: 100px;
            margin-right: 10px;
            display: inline-block;
        }

        .skins {
            list-style: none;
            padding-left: 0px;
            overflow-y: scroll;
            overflow-x: hidden;
            height: 264px;
            border-top: 2px dashed silver;
        }

        .skins li {
            margin-bottom: 4px;
        }
    </style>
    <script>
        window.onload = function () {
            let perses = [["Knight", "Рыцарь", 14], ["Ranger", "Разбойник", 13], ["Mage", "Маг", 14], ["Assassin", "Ассасин", 13], ["Alchemist", "Алхимик", 10], ["Engineer", "Инженер", 13], ["Vampire", "Вампир", 11], ["Paladin", "Паладин", 14], ["Elves", "Ельф", 11], ["Werewolf", "Оборотень", 15], ["Priest", "Священник", 12], ["Druid", "Друид", 10], ["Robot", "Робот", 12], ["Viking", "Берсерк", 14], ["Necromancer", "Некромант", 7], ["Officer", "Офицер", 8], ["Taoist", "Даос", 9]];
            for (let i = 0; i < perses.length; i++) {
                let main = document.createElement("div");
                main.className = "pers";
                main.id = "c" + i.toString();
                let temp = document.createElement("div");
                temp.innerHTML = perses[i][1];
                main.appendChild(temp);
                temp = document.createElement("img");
                temp.src = perses[i][0] + "/p.webp";
                temp.height = 64;
                temp.style = "display: block;";
                main.appendChild(temp);
                temp = document.createElement("input");
                temp.type = "checkbox";
                main.appendChild(temp);
                temp = document.createElement("ul");
                temp.className = "skins"
                for (let y = 0; y < perses[i][2]; y++) {
                    let li = document.createElement("li");
                    let im = document.createElement("img");
                    let checkbx = document.createElement("input");
                    checkbx.type = "checkbox";
                    im.src = perses[i][0] + "/" + (y + 1).toString() + ".webp";
                    im.width = "50";
                    li.appendChild(im);
                    li.appendChild(checkbx);
                    temp.appendChild(li);
                }
                main.appendChild(temp);
                document.getElementById("patches").appendChild(main);
            }
        };
        function updateData() {
            let file = document.getElementById("input").files[0];
            let reader = new FileReader();
            reader.onload = function () {
                var oParser = new DOMParser();
                var oDOM = oParser.parseFromString(reader.result, "application/xml");
                for (let i = 0; i < 17; i++) {
                    document.getElementById("c" + i.toString()).children[2].checked = (oDOM.getElementsByName("c" + i.toString() + "_unlock")[0].innerHTML == "true") ? true : false;
                    let oSkins = document.getElementById("c" + i.toString()).children[3];
                    for (let y = 1; y < oSkins.children.length; y++) {
                        oSkins.children[y - 1].children[1].checked = (oDOM.getElementsByName("c" + i.toString() + "_skin" + y.toString())[0].attributes[1].value == "1") ? true : false;
                    }
                }
            };
            reader.readAsText(file, "UTF-8");
        }
        function generateSave() {
            let file = document.getElementById("input").files[0];
            let reader = new FileReader();
            let outt;
            let ready = false;
            reader.onload = function () {
                var oParser = new DOMParser();
                var oDOM = oParser.parseFromString(reader.result, "application/xml");
                for (let i = 0; i < 17; i++) {
                    //oDOM.getElementsByName("c" + i.toString() + "_unlock")[0].innerHTML = (document.getElementById("c" + i.toString()).children[2].checked) ? "true" : "false";
                    let oSkins = document.getElementById("c" + i.toString()).children[3];
                    for (let y = 1; y < oSkins.children.length; y++) {
                        oDOM.getElementsByName("c" + i.toString() + "_skin" + y.toString())[0].attributes[1].value = (oSkins.children[y - 1].children[1].checked) ? "1" : "0";
                    }
                }
                let ser = new XMLSerializer;
                outt = ser.serializeToString(oDOM);
                let blob = new Blob([outt], { type: "application/octet-stream" });
                let url = window.URL.createObjectURL(blob);
                let a = document.getElementById("down");
                a.href = url;
                a.onclick = function () {
                    document.getElementById("down").onclick = generateSave;
                };
                a.click();
            };
            reader.readAsText(file, "UTF-8");
            event.preventDefault();
        }
    </script>
</head>

<body>
    <h1 style="color: red;">БЕТА ТЕСТ САЙТА</h1>
    <hr>
    <div>
        <h2>Файл с сохранением</h2><input type="file" id="input" style="display: inline-block;" onchange="updateData()">
    </div>
    <div>
        <h2>"Пропатченое" сохранение</h2>
        <a id="down" href="#" download="com.ChillyRoom.DungeonShooter.v2.playerprefs.xml" onclick="generateSave()"><div id="link">Скачать</div></a>
        <div style="color: red; font-size: larger; margin-top: 10px;">!Важно!</div> Нельзя просто вставить пропатченый файл в в папку shared prefs,
        нужно текстовым редактором заменить содержимое непропатченого файла на содержимое пропатченого (copy paste)
    </div>
    <h2>Выбор скинов</h2>
    <div id="patches"></div>
    <span>P.S. разблокировка персонажей в данный момент не работает
    </span>
</body>

</html>